# ディスカッションペーパー（改訂版）
## 保全日報入力・修理受付のAI活用（Power Apps × Azure AI Search × Azure OpenAI）

作成日: 2025-12-17  
版: v0.2（議論用叩き台）

---

## 0. 本ペーパーの位置づけ
本資料は、顧客要望（Power Appsで修理受付 → 過去類似案件提示 → 完了時に原因/処置を追記してナレッジ蓄積、かつ自由記述の表記揺れ・情報不足をAIで補う）を踏まえ、**提案書作成前の論点整理と実装方針の合意形成**を目的とするディスカッションペーパーである。

---

## 1. 背景・課題（As-Is）
### 1.1 背景
- 修理受付に Power Apps を利用し、ライン/設備/現象等を入力する運用を検討中
- 受付時にAIが過去情報から類似案件の原因・処置を提示し、初動を支援したい
- 修理完了時に原因・処置を追記し、データ登録（ナレッジ蓄積）したい

### 1.2 主な課題
- **自由記述の表記揺れ**（同義語・略語・言い回し）により検索/分析が困難
- **情報の不足（歯抜け）**により、類似検索や再発防止分析の精度が上がらない
- **属人化**（経験者だけが速い）と、再発傾向の可視化不足

---

## 2. 目的（To-Be）
### 2.1 目的
- **復旧の高速化**：受付時に類似案件（原因・処置）を提示し初動を短縮
- **ナレッジの品質向上**：入力支援で歯抜けと表記揺れを減らし、使えるデータにする
- **再発防止につながる蓄積**：設備×現象×原因×処置の分析を可能にする

### 2.2 成果指標（例）
- 類似検索の有用率（現場評価で「役に立った」割合）
- 初動着手までの時間/復旧時間の短縮
- 必須項目の充足率（歯抜け率の低下）
- 分類コード付与率、表記揺れ指標（同義語統一の進捗）

---

## 3. 全体コンセプト（成功しやすい二層構え）
### 3.1 早期価値：RAG（検索＋要約）で「過去事例を正しく引く」
- 受付時に **Azure AI Search（ハイブリッド検索）**で類似案件を取得
- 取得した案件を **Azure OpenAI**で短く要約して提示（根拠＝参照案件を明示）

### 3.2 中長期価値：入力支援で「データを育てる」
- 自由記述は残しつつ、**分類コード・標準語・必須項目**を整備して検索/分析精度を底上げ
- いきなりAIに「質問セット推論」をさせず、初期は **ルールベース固定補足質問**で歯抜けを防ぐ

---

## 4. 初期版（Phase 1）での実装方針：AI推論を最小化して堅く立ち上げる
### 4.1 受付時の必須入力（初期）
- 発生日時（occurred_at）
- ライン（line）
- 設備（equipment）
- 現象（自由記述：symptom_raw）
- （推奨：できれば必須）現象分類コード（symptom_category）

> **分類コードに応じて固定の補足質問セットを表示**し、必須質問が未回答なら登録できない（歯抜け防止）。

### 4.2 固定補足質問（共通＋カテゴリ別）
- **全案件共通の固定（最低限）**
  - 発生タイミング、頻度、影響（停止/品質/安全）、再現性、復旧操作、発生箇所
- **カテゴリ別の固定質問セット（例）**
  - 異音：音の種類/位置/回転体連動/発生条件
  - 漏れ：流体種/箇所/量/圧力条件
  - 電装：エラーコード/電源状態/リセット結果/直前変更

> 質問文・入力型・必須/任意はマスタで管理し、分類コードにより機械的に表示する（AIに推論させない）。

---

## 5. 検索（類似案件提示）の実装案：Azure AI Search（ハイブリッド）
### 5.1 検索の基本
- **キーワード検索（BM25）＋ベクトル検索**を組み合わせる（ハイブリッド）
- フィルタ（ライン/設備/期間）が指定できる場合は精度向上のため優先的に適用

### 5.2 “優先度（設備寄り/現象寄り）”の設計
#### 自動優先（通常運用）
- 設備がLookupで確定している（設備IDが取れている） → **設備寄り**
- 設備が未確定/不明 → **現象寄り**
- ラインは一致ブースト（ランキング寄せ）に使う

#### UIでの優先指定（必要時）
- 「設備起点」「現象起点」「ライン起点」「バランス」などの**プリセット（モード）**を推奨
- 上級者向けに詳細設定（重みスライダー）も可能（ただし初期は非推奨）

### 5.3 ベクトル設計（複数ベクトルで制御しやすく）
- equipmentVector：設備名/設備系統/部位などから埋め込み
- symptomVector：現象記述（symptom_raw/補足回答要約など）から埋め込み
- 検索時は複数ベクトルクエリに重みを付与して優先度を実現（例：設備起点モードは equipmentVector の weight を高く）

### 5.4 表記揺れ対策（検索側）
- **キーワード検索側**には Azure AI Search の **synonym map（シノニム）**を適用し、略語・同義語をOR展開
  - 例：INV ↔ インバータ、モータ ↔ 電動機、異音 ↔ うなり/ギュルギュル など
- ベクトル検索側は意味類似で吸収できるが、略語はシノニムが効くケースも多い

---

## 6. 入力支援（受付・完了）のUI案（Power Apps）
### 6.1 受付画面（最小構成）
- 必須：日時・ライン・設備・現象（自由記述）・（分類コード）
- 共通チェック（固定）＋カテゴリ別チェック（固定質問セット）を同画面に表示
- 右パネル（または別画面）で類似案件Top Nと要約を表示

**画面モック（例）**
- ライン：Aライン
- 設備：包装機 INV-3
- 現象（自由記述）：立上げ時にギュルギュル音、2回停止。ベルト周り？
- 現象分類：機械 > 異音
- 共通チェック：発生タイミング=起動時、頻度=断続、影響=停止 など
- 異音チェック：音の種類=うなり、位置=搬送ベルト、回転体連動=不明 など
- 類似案件：上位3件＋原因/処置要約（参照元チケットIDつき）

### 6.2 完了画面（原因・処置の確定）
- 原因/処置は自由記述を残しつつ、**主原因（1つ）/主処置（1つ）**をマスタから確定
- 必要なら副要因・複数処置（多対多）を追加

> 「AIが構造化案を提示 → 作業者が承認/修正」はPhase 2以降で導入してもよいが、初期は運用負荷に応じて段階導入とする。

---

## 7. データモデル（最小骨格）
### 7.1 ねらい
- 受付・完了の**正本データ**（Dataverse等）を持ち、検索用にAzure AI Searchに同期
- 補足質問はカテゴリで増減するため、回答は「縦持ち（Ticket×Question×Answer）」で保持し、テーブル定義の変更を不要にする

### 7.2 テーブル（概要）
- マスタ
  - ライン（M_Line）
  - 設備（M_Equipment）
  - 現象分類（M_SymptomCategory：階層）
  - 原因（M_Cause）
  - 処置（M_Action）
  - 質問（M_Question）
  - 質問セット割当（M_QuestionSet：分類→質問）
- トランザクション
  - チケット（T_Ticket：受付/完了の固定列）
  - 補足回答（T_TicketAnswer：縦持ち回答）

※ER図・テーブル定義（日本語項目名つき）は別紙（添付）として運用

---

## 8. 推奨アーキテクチャ（Power Apps開発を最小化）
### 8.1 方針
- Power Appsは **薄い入力フォーム**に徹し、複雑ロジックはサーバ側へ寄せる
- RAG（検索＋要約）は **Azure Functions（またはApp Service）**で集約

### 8.2 構成例
- UI：Power Apps（受付・完了・類似表示）
- データ正本：Dataverse（または既存CMMS/SQL/SharePointも選択肢）
- 連携：Power Automate（登録トリガー、同期、通知）
- 検索：Azure AI Search（ハイブリッド、シノニム）
- 生成：Azure OpenAI（要約、（将来）構造化案生成）
- API：Azure Functions（Power Appsから呼ぶ/同期処理を集約）
- 可視化：Power BI（停止時間、再発、設備別傾向）

> RAGが必須の場合、Functions側で「AI Search→OpenAI→JSON応答」をまとめると、Power Appsの実装が薄くなり運用が安定しやすい。

---

## 9. 段階導入ロードマップ（案）
### Phase 0：棚卸し（短期）
- 過去データ（保全日報/修理履歴）の所在確認、欠損・揺れの実態把握
- 分類コード体系の初期案策定（粗くてよい）

### Phase 1：固定補足質問＋類似案件提示（早期価値）
- 受付の必須項目＋分類コードによる固定補足質問
- Azure AI Searchで類似提示＋Azure OpenAIで要約
- KPI：有用率、必須項目充足率、初動短縮

### Phase 2：入力支援の高度化（任意）
- 分類コードの自動候補提示
- 自由記述→標準語候補/カテゴリ提案、承認プロセス
- シノニム/辞書の運用整備（レビュー頻度・責任者）

### Phase 3：分析・再発防止（拡張）
- Power BIで傾向分析、対策効果の可視化
- 将来的にセンサ/ログと連携できれば予兆領域も検討

---

## 10. リスクと対策
- AI誤誘導：提示は根拠（参照案件）付き、最終判断は人、注意文表示
- 歯抜け：必須質問未回答は登録不可、カテゴリ別必須セットをマスタで管理
- 運用崩れ：辞書・分類の更新責任者、月次レビュー、変更履歴
- セキュリティ：権限（Dataverse/Entra ID）、ログ、データ持ち出し制御

---

## 11. 次回打合せで合意したい事項（アジェンダ）
1) 分類コード体系（大分類/小分類の粒度、必須化の方針）
2) カテゴリ別固定質問セット（必須/任意、10問以内目標）
3) 類似検索の対象期間（例：直近2年）と表示件数（Top 3/5/10）
4) データ正本（Dataverse/既存システム）と同期方式
5) PoC範囲（対象ライン・設備、成功基準KPI）

---

# 付録A：用語
- **RAG**：検索（Retrieve）で根拠文書を取得し、生成（Generate）で要約/回答を作る方式
- **ハイブリッド検索**：キーワード（BM25）とベクトル（意味検索）を組み合わせる方式
- **縦持ち**：質問が増減しても列を増やさず、Ticket×Question×Answer を行で増やすデータ設計
