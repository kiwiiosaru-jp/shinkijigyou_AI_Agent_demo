# 提案方針・フィットギャップ（GenU フルオプション基盤ベース）

## 1. 当社提案方針の案です
- **短期（3か月）で「共通RAG/LLMゲートウェイ＋AgentCore」を最小構築し、全社標準APIでガバナンスを効かせる。**
- **データ統合は Box → 共通パイプライン（前処理/メタ付与/チャンク設定可）→ ベクトルDB（既定: Bedrock KB/AOSS、高要求: Aurora pgvector）で段階拡張。**
- **非機能（性能・可用性・監視・セキュリティ）はフェーズごとに強化し、オートスケールと復旧方式を要素別に設計（アプリ/API/LLM/RAG/ベクトルDB）。**
- **AIエージェントの将来展開を見据え、フェーズ1から AgentCore を基盤に組込み、以降のエージェント開発は AgentCore API/ガバナンス準拠を必須化。**

## 2. エグゼクティブサマリ
- GenUフルオプションを核に、**共通LLMゲートウェイ/APIを全社標準インターフェース**として提示し、以降のアプリはこのAPIを利用するガバナンスモデルを採用。
- **3か月MVPで実装すべき最小スコープ**: 認証（Entra SAML）、共通API（LLM/RAG）、Box取込パイプライン最小版、RAG検索（KB/AOSS or Aurora pgvectorのどちらかを優先選択）、監視/バックアップ基礎、AgentCore組込み、**最小メタ付与（部門/権限などアクセス制御に必要なメタのみ）**。
- **フェーズ2以降**で: Box差分/Webhook・**メタ付与の拡張（要約/タグ/Q&A化など精度向上系）**、管理UI拡張（容量/部門/お知らせ/ログ）、検索UI拡張（スコア/履歴/類似検索等）、Fargate/ALBへの移行を必要に応じて実施。セキュリティ/監査/閉域はPh1で実装済み。
- **リスク/ギャップ**: Box連携（pgvector側はAPI実装が必要）、PostgreSQLベクトル指定、ALB+Fargate要求、管理UI拡張。いずれも追加開発で吸収可。
- **RFPアーキ準拠の段階移行**: フェーズ1は GenU標準（APIGW+Lambda+CF/S3静的）でフロント＆バックを最短立ち上げ、フェーズ2でフロントのみ ALB+Fargate へ移行しつつ、API は APIGW+Lambda を継続利用して RFP 図の「フロント=ALB/Fargate・バック=APIGW/Lambda」を実現。

## 3. 段階開発プラン
- **フェーズ1（～3か月、MVP）**  
  - フロント/バック: GenU標準の CloudFront+S3（静的SPA）＋ API Gateway + Lambda をベースに、VPC 内にバックエンドを配置（RFPの閉域前提）。  
  - 認証: Entra SAML + Cognito。  
  - 共通API/ゲートウェイ: LLM/RAG/AgentCore を API Gateway + Lambda で提供し、社内アプリはこのAPI利用を必須化。  
  - RAG: KB（Bedrock KB/AOSS 既定）または Aurora pgvector のどちらかを優先採用（両対応も可だが期間タイトなら片側）。  
  - 部門ユーザ管理: 部門管理者向けの最小 UI/機能を追加（部門別ユーザー参照/追加/削除、権限付与）。Cognito/Entra のグループ属性を前提とし、APIGW+Lambda+DynamoDB で設定管理。  
  - Box連携: 定期Pull＋手動起動の最小パイプライン（前処理/チャンク/メタ最小）。  
  - AgentCore: 基盤として組込み（今後のエージェント開発は AgentCore API へ集約）。  
  - システム管理者 Want を AWS 標準で充当: CloudWatch Dashboards/Logs Insights で利用状況・エラー監視、S3+Athena/CloudTrail でログエクスポート、Aurora/KB コンソールで容量/バックアップ確認。  
  - 非機能: RPO/RTO基準、DDB PITR、S3バージョン管理、基本監視/ダッシュボード、ガードレール基礎。  
  - 可用性/性能: サーバレス優先、チャンク上限/軽量モデル/同時実行の制御を初期設定。

- **フェーズ2（+1–2か月）**  
  - フロント: React アプリをコンテナ化して Fargate 常時起動、ALB 経由で配信（RFP 図に合わせる）。API 呼び出し先は引き続き APIGW のまま。  
  - バック/API: APIGW + Lambda を継続利用し、UI側のみホスティング方式を移行。  
  - Box Webhook/差分取込、メタ拡張（要約/タグ/Q&A 等精度向上系）、部門別アクセス制御/容量管理の強化（Ph1で付与したメタを活用し UI/運用へ拡張）。  
  - 管理UI拡張: システム管理者向けカスタムUI（ダッシュボード/利用状況/ログ閲覧/お知らせ配信）、部門管理者向けUI（部門ダッシュボード、文書/アクセス権限管理、検索エクスポート、アップロード/インデックス管理）。  
  - 検索UI拡張（Want系の追加開発）: 関連性スコア表示、類似検索提案、検索履歴表示、フィードバックコメント入力/保存を段階的に追加。  
  - オートスケール調整: フロント（CF/Lambda@Edge or Fargate）、バック/API、LLM呼び出し同時実行、RAG（KB/Kendra or pgvector）、ベクトルDBのスロット/キャパ。  
  - Fargate/ALB構成が必須ならここで切替。
  - 移行効果: インフラ強化は主にフロント差し替えで済み、RAG/LLMのコア実装への影響を最小化。  

- **フェーズ3（+1–2か月）**  
  - DR演習、性能テスト自動化、AIガバナンス高度化（Ph1で導入したガードレールをバイアス/PII含め精緻化）。  
  - メタデータ高度化（分類・辞書補正自動化）、部門ダッシュボード高度化、**データガバナンス強化（RAG投入文書の承認・棚卸し・ライフサイクル管理）**、部門管理者/一般向け UI の残項目（マイページ/通知/FAQ 等）、追加SaaS連携（SharePoint 等）。  
  - コスト最適化（自動起動/停止、モデル/チャンク最適化）。

## 4. フィットギャップ一覧（実装フェーズつき、工数は概算）
| 項目 | RFP | 現状 | 方針 | Phase | 人日 |
| --- | --- | --- | --- | --- | --- |
| 認証・SSO | Entra SAML | × | IdP統合、ドメイン設定、E2Eテストを新規実装（GenU標準は未設定） | P1 | 8–12 |
| API基盤 | APIGW+Lambda | ◯ | GenU標準のAPI基盤を利用 | P1 | 0 |
| API/ガバナンス | 全社標準API | × | API必須化、仕様/SDK提供、ガードレール適用を運用ルールとして追加実装 | P1 | 5–8 |
| 文書管理ガバナンス | 承認/棚卸/LC | × | 承認WF・棚卸し・ライフサイクル管理を新規実装 | P3 | 10–15 |
| ネットワーク/セキュリティ | WAF/Shield/監査 | ◯ | パラメータ設定で WAF/Shield/CloudTrail/Config/Inspector を有効化し、IP/CIDR制限・レート制御・Bot/SQLi/XSS ルールと監査ログを整備 | P1 | 8–12 |
| ネットワーク構成（フロント） | CF+S3+APIGW+Lambda | ◯ | P1はGenU標準のCF+S3+APIGW+Lambda（VPC内）で立ち上げ、閉域前提を満たす | P1 | 0 |
| ネットワーク構成（フロント） | ALB+Fargate | × | P2で同一VPC内の Fargate+ALB へ移行し、UIをコンテナ常時起動に切替（APIGWは継続） | P2 | 20–25 |
| オンプレ接続 | TGW+VPN | × | P1から Site-to-Site VPN＋TGW を構成し社内ネットワーク経由で利用（必要に応じ PrivateLink も併用） | P1 | 10–15 |
| RAG KB（AOSS） | Bedrock KB/AOSS | ◯ | GenU標準のBedrock KB + AOSSをそのまま活用 | P1 | 0 |
| RAG（pgvector） | PostgreSQL(Aurora pgvector) | × | Lambda/API をpgvector用に新規実装し、メタ/検索/埋め込み/リランク対応を追加 | P1 | 25–30 |
| RAG Kendra | Kendra利用 | ◯ | GenU標準のKendra連携を有効化（不要なら無効化も可） | P1/Opt | 0–10 |
| OCR/表構造保持 | OCR+表保持 | × | Textractで画像/スキャンPDFをテキスト化し、表はHTML/MD/CSVとしてメタ付きでS3へ投入。KB標準に任せず前処理で精度を担保 | P1 | 12–18 |
| PDF大容量/分割 | 50MB超や長文PDF | × | P1で分割設定と自動分割バッチ/ツールを用意し、大容量PDFを安全にインジェスト | P1 | 6–8 |
| チャンク戦略変更 | セマンティック/階層 | × | P2で KB のチャンク戦略を切替（固定長/階層/セマンティック）、業務ドメインに合わせてパラメータ調整 | P2 | 4–6 |
| データクレンジング/正規化 | ヘッダ削除・正規化 | × | P2前処理でヘッダ/フッタ・特殊記号/HTMLタグを除去し、全角半角・日付フォーマットを正規化 | P2 | 8–12 |
| 辞書補正/ゆらぎ補正 | ISUZU→いすゞ等 | × | P2前処理で辞書/表記ゆらぎを補正（社内用語辞書を管理し適用） | P2 | 6–8 |
| Q&A変換・要約タグ付与 | FAQ化/タグ付与 | × | P3 LLMバッチでマニュアル等をQ&A化し、タグ/要約を生成してメタとして付与 | P3 | 12–18 |
| 連続性/RPO/RTO | RPO1日/RTO12h目安 | × | P1: DDB PITR(35日)、Aurora/pgvector日次スナップショット＋リストアRunbook、S3版管理、復旧演習まで実施しRPO/RTOを監視に組込み | P1 | 12–18 |
| 稼働率/多AZ | 99.7% | × | P1: サーバレス冗長(λ/APIGW/CF)、Aurora Multi-AZ を前提にSLAモニタと障害対応Runbookを用意 | P1 | 8–12 |
| バックアップ保持/復旧演習 | DynamoDB/pgvector保持 | × | P1: DynamoDB PITR35日、Aurora日次スナップショット(保持30日)、復旧手順整備と演習を実施 | P1 | 10–14 |
| 管理ダッシュボード/利用状況/ログ | 利用/エラー/エクスポート | × | P1はAWSコンソール(CW Dashboards/Logs Insights/Athena+S3/CloudTrail)を整備し即時可視化。後続で非AWSユーザ向けにカスタム管理UIを追加 | P1 | 12–18 |
| ユーザ管理（全体） | 一覧/ロール/停止 | × | P1 Cognito/Entraコンソールで運用し、必要に応じUI化 | P1 | 5–8 |
| ベクトルDB管理 | 容量/最適化/バックアップ | × | P1は Aurora/KB/AOSS コンソール＋SQL/スナップショットで運用し、Runbook/自動化もセットで整備 | P1 | 10–15 |
| 参照元表示/リンク | 出典/直リンク/ページ | ◯ | GenU標準UIの出典表示を有効化（ドキュメント名/パス/ページ番号/直リンク） | P1 | 0 |
| 検索結果プレビュー | チャンク確認 | ◯ | GenU標準の抜粋/プレビュー表示を利用 | P1 | 0 |
| 関連性スコア表示 | スコア表示 | × | P1でバックエンドのスコアをUIに数値表示し、根拠の強弱を把握可能にする | P1 | 4–6 |
| フィルター機能 | 日付/メタ絞り込み | ◯ | GenU標準のメタフィルタを有効化（department/access_level等）。追加メタが必要なら後続で拡張 | P1 | 0 |
| 類似検索提案 | 履歴ベクトル検索 | × | P2で検索履歴をベクトル化し類似クエリを提示、ナビゲーションを改善 | P2 | 8–12 |
| 検索履歴表示 | 履歴一覧/再検索 | × | P2で履歴一覧とワンクリック再検索を提供 | P2 | 6–10 |
| 回答評価 | いいね等 | × | P1でいいね/バッドを保存し、モデル/プロンプト調整のフィードバックに活用 | P1 | 6–10 |
| フィードバックコメント | 精度/性能FB | × | P1で自由入力のフィードバック欄を追加（DDB保存や外部フォームリンク） | P1 | 6–10 |
| 部門ユーザ管理 | 部門ユーザ/権限/容量 | × | P1で部門管理者向け最小UIを提供（部門別ユーザ一覧/追加/削除/権限付与、設定はDDBで保持） | P1 | 12–18 |
| 部門管理 | 部門作成/編集/容量 | × | P2 部門管理UI（DDB/Parameter Store） | P2 | 10–15 |
| お知らせ管理 | 障害/告知配信 | × | P2 通知UI＋SNS/メール/バナー配信 | P2 | 8–12 |
| 部門ダッシュボード | 部門内利用/人気KW | × | P2で部門単位の利用数/人気KW/容量などを可視化するダッシュボードを追加（CW Logs/Athena集計） | P2 | 12–18 |
| 文書/アクセス権限UI | 文書一覧/メタ/ACL | × | P2で文書一覧・メタ編集・タグ/カテゴリ付与・ACL設定を行う管理UIを追加（メタ/ACLはDDB等で管理） | P2 | 18–24 |
| 高度検索/結果エクスポート | フィルタ/エクスポート | × | P2 UIでフィルタ拡張・結果エクスポート | P2 | 12–18 |
| アップロード/インデックスUI | 一括アップ/進捗/再実行 | × | P2で一括アップロード・進捗表示・インデックス状態確認/再実行を行うUIを追加 | P2 | 12–18 |
| マイページ/通知/FAQ | プロフィール/通知/ヘルプ | × | P3 カスタムUI＋通知連携 | P3 | 10–15 |
| Boxパイプライン（最小） | Box取込/メタ/通知 | × | P1: 最小取込とメタ付与を実装 | P1 | 20–25 |
| Boxパイプライン（差分/Webhook） | Box差分/Webhook/前処理拡張 | × | P2: 差分取込/Webhookと前処理拡張を追加 | P2 | 10–15 |
| SharePointパイプライン | SharePoint取込 | × | P2 Graph APIで定期/差分→S3、必要に応じ前処理 | P2 | 18–24 |
| Box→pgvector | Box→S3→pgvector | × | API連携実装（前処理後にpgvector格納） | P1 | 12–18 |
| 前処理カスタム | Python差込 | × | 前処理モジュール化し差替え可能に | P1 | 10–15 |
| リランク（pgvector） | リランク必須 | × | 再ランキングAPI/内製を追加 | P1 | 10–15 |
| メタ情報・部門別制御 | 部門別アクセス制御 | × | メタ格納＋APIでフィルタ（department/access_level等） | P1 | 12–18 |
| 共通API改修 | メタフィルタ | × | APIでメタフィルタ適用・検証 | P1 | 8–12 |
| 管理UI | 容量/部門/お知らせ/ログ | × | 管理UI拡張（容量/部門/告知/ログ閲覧） | P2 | 18–24 |
| AgentCore | エージェント基盤 | ◯ | P1で組込み、以降の開発を集約 | P1 | 5–8 |
| メタ付与/Q&A | 要約/タグ/Q&A | × | 前処理に生成系ジョブ追加 | P2 | 12–18 |
| オートスケール | 要素別スケール | × | 各コンポーネントの同時実行/スロット調整 | P2 | 10–15 |
| 性能 | 応答10–60秒 | × | モデル選定/チャンク抑制/同時実行/キャッシュ最適化を追加実装 | P1 | 5–8 |
| 可用性 | RPO24h/RTO12h | × | DDB PITR、Auroraバックアップ/MAZ、Runbook | P1 | 8–12 |
| 監視 | トークン/ファイル/異常検知 | × | CloudWatch Logs/Dashboardsを整備し、Athena/アラートでトークン/ファイル/異常検知を追加実装 | P1 | 6–8 |
| オートスケール/性能・可用性 | サーバレス→Fargate候補 | × | P1サーバレス、P2でFargate常時起動に切替可能な設計 | P1 | 10–15 |
| RAG精度モニタ/評価 | 精度チェック | × | 評価データセットと指標(EM/F1/HitRate等)を整備し、定期精度チェックとリランク/前処理調整ループを新規実装 | P3 | 15 |
| 暗号化/鍵管理 | 暗号化/秘匿 | ◯ | パラメータでS3/KMS、Aurora/DynamoDB暗号化、TLS終端、CMK運用(キー分離/ローテ)、ベクトルデータの保存時暗号化と転送時TLS確認まで実施 | P1 | 0–2 |
| 監査/ログ | CloudTrail/CWL/Config | ◯ | CloudTrail全リージョン/Org、APIGW/Lambda/Bedrock/KB/Kendraのログ出力、Configルール、Athena/Security Lakeで横断分析を有効化 | P1 | 0–2 |
| 脅威検知/セキュリティ運用 | GuardDuty/SecurityHub/Inspector | ◯ | GuardDuty/SecurityHub/Inspectorを有効化し、基本アラート連携・Runbook整備 | P1 | 0–2 |
| WAF/Shield | DDoS/入力検査 | ◯ | WAF/Shield を有効化し、IP/CIDR制限・レート制御・Bot/SQLi/XSS ルールを適用 | P1 | 0–2 |
| PrivateLink/VPC Endpoints | 安全なサービス間通信 | ◯ | 必要な PrivateLink/VPCエンドポイントを配置し、閉域経路を構成 | P1 | 0–2 |
| テスト/検証 | 負荷・侵入テスト | × | P1で負荷テスト/セキュリティ診断（Inspector等）を実施し、RPO/RTO/スロットリングの実測を取得 | P1 | 8–12 |

## 5. 工数目安（概算・人日、実装中心／ざっくりご参考の工数です。AWSアーキテクトに見ていただいた方がいいかも）
- フェーズ1: **132–174人日**  
  - SSO/認証統合、API標準化、VPC+VPN/TGW+PrivateLink、WAF/Shield/監査/脅威検知、RPO/RTO/バックアップ演習、RAG配線(KB/AOSS/pgvector)、Box最小取込、前処理(OCR/分割/クレンジング一部)、検索UI必須機能（出典/プレビュー/スコア/評価/フィードバック）、部門ユーザ管理、暗号化/KMS、監査ログ、負荷/セキュリティテスト、AgentCore などを包含
- フェーズ2: **30–45人日**  
  - 管理/部門向けカスタムUI拡張、検索Want機能拡張（履歴/類似検索/エクスポート等）、前処理高度化（クレンジング/辞書/チャンク戦略）、Fargate/ALBへの移行や運用自動化、ベクトルDB管理UI、自動分割ツール、Box差分/Webhook、SharePoint取込 など
- フェーズ3: **35–45人日**  
  - Q&A変換・タグ/要約生成の高度化、残りの一般向けUI（マイページ/通知/FAQ）、AIガバナンス強化、追加SaaS連携、コスト最適化

※要件定義・テスト・PMは別途。スコープに応じ前後します。

## 6. メモ・補足
- RFP図のフロントは ALB+Fargate。フェーズ1は GenU 標準（CF+S3+APIGW+Lambda）かつVPC内で立ち上げ、必要に応じ同一VPCで Fargate+ALB に差し替え。API は APIGW+Lambda を継続。  
- RFP図は Site-to-Site VPN + Transit Gateway 前提。フェーズ1から VPN/TGW/PrivateLink を構成し、閉域接続で提供。  
- Kendra: RFPに明示なし。不要なら外し、KB/pgvectorに一本化。  
- Box: Kendra向けアダプタはあるが、pgvectorルートは自前API実装が必要。  
- Textract: Azure Document Intelligence 相当。スキャンPDF/OCR/表抽出が必要な場合は前処理で利用し、HTML/Markdown/CSVに整形して KB/Kendra へ投入。  
- オートスケール/可用性:  
  - フロント/静的: CF+S3（サーバレス）。Fargate採用時はタスク/ターゲット数でスケール。  
  - API/Lambda: Concurrency・Retry・タイムアウト調整。APIGWスロット設定。  
  - LLM: モデル同時実行上限・軽量モデル優先・チャンク数制御。  
  - RAG KB: KB/AOSS スロット、Aurora pgvector は ACU/最大接続/マルチAZ。  
  - 可用性: サーバレスはマネージド冗長。AuroraはマルチAZ、バックアップ方針明示。DRはコールド/ウォーム選択（RTO/RPOとコストで決定）。
