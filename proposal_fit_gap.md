# 提案方針・フィットギャップ（GenU フルオプション基盤ベース）

## 1. 当社提案方針の案です
- **短期（3か月）で「共通RAG/LLMゲートウェイ＋AgentCore」を最小構築し、全社標準APIでガバナンスを効かせる。**
- **データ統合は Box → 共通パイプライン（前処理/メタ付与/チャンク設定可）→ ベクトルDB（既定: Bedrock KB/AOSS、高要求: Aurora pgvector）で段階拡張。**
- **非機能（性能・可用性・監視・セキュリティ）はフェーズごとに強化し、オートスケールと復旧方式を要素別に設計（アプリ/API/LLM/RAG/ベクトルDB）。**
- **AIエージェントの将来展開を見据え、フェーズ1から AgentCore を基盤に組込み、以降のエージェント開発は AgentCore API/ガバナンス準拠を必須化。**

## 2. エグゼクティブサマリ
- GenUフルオプションを核に、**共通LLMゲートウェイ/APIを全社標準インターフェース**として提示し、以降のアプリはこのAPIを利用するガバナンスモデルを採用。
- **3か月MVPで実装すべき最小スコープ**: 認証（Entra SAML）、共通API（LLM/RAG）、Box取込パイプライン最小版、RAG検索（KB/AOSS or Aurora pgvectorのどちらかを優先選択）、監視/バックアップ基礎、AgentCore組込み、**最小メタ付与（部門/権限などアクセス制御に必要なメタのみ）**。
- **フェーズ2以降**で: Box差分/Webhook・**メタ付与の拡張（要約/タグ/Q&A化など精度向上系）**、管理UI拡張（容量/部門/お知らせ/ログ）、セキュリティ強化（WAF/PrivateLink/GuardDuty/Security Hub）、オートスケール/性能・可用性設計の細分化、Fargate/ALBが必要ならここで切替。
- **リスク/ギャップ**: Box連携（pgvector側はAPI実装が必要）、PostgreSQLベクトル指定、ALB+Fargate要求、管理UI拡張。いずれも追加開発で吸収可。
- **RFPアーキ準拠の段階移行**: フェーズ1は GenU標準（APIGW+Lambda+CF/S3静的）でフロント＆バックを最短立ち上げ、フェーズ2でフロントのみ ALB+Fargate へ移行しつつ、API は APIGW+Lambda を継続利用して RFP 図の「フロント=ALB/Fargate・バック=APIGW/Lambda」を実現。

## 3. 段階開発プラン
- **フェーズ1（～3か月、MVP）**  
  - フロント/バック: GenU標準の CloudFront+S3（静的SPA）＋ API Gateway + Lambda。追加インフラを最小にして短期立ち上げ。  
  - 認証: Entra SAML + Cognito。  
  - 共通API/ゲートウェイ: LLM/RAG/AgentCore を API Gateway + Lambda で提供し、社内アプリはこのAPI利用を必須化。  
  - RAG: KB（Bedrock KB/AOSS 既定）または Aurora pgvector のどちらかを優先採用（両対応も可だが期間タイトなら片側）。  
  - 部門ユーザ管理: 部門管理者向けの最小 UI/機能を追加（部門別ユーザー参照/追加/削除、権限付与）。Cognito/Entra のグループ属性を前提とし、APIGW+Lambda+DynamoDB で設定管理。  
  - Box連携: 定期Pull＋手動起動の最小パイプライン（前処理/チャンク/メタ最小）。  
  - AgentCore: 基盤として組込み（今後のエージェント開発は AgentCore API へ集約）。  
  - システム管理者 Want を AWS 標準で充当: CloudWatch Dashboards/Logs Insights で利用状況・エラー監視、S3+Athena/CloudTrail でログエクスポート、Aurora/KB コンソールで容量/バックアップ確認。  
  - 非機能: RPO/RTO基準、DDB PITR、S3バージョン管理、基本監視/ダッシュボード、ガードレール基礎。  
  - 可用性/性能: サーバレス優先、チャンク上限/軽量モデル/同時実行の制御を初期設定。

- **フェーズ2（+1–2か月）**  
  - フロント: React アプリをコンテナ化して Fargate 常時起動、ALB 経由で配信（RFP 図に合わせる）。API 呼び出し先は引き続き APIGW のまま。  
  - バック/API: APIGW + Lambda を継続利用し、UI側のみホスティング方式を移行。  
  - Box Webhook/差分取込、メタ拡張（要約/タグ/Q&A 等精度向上系）、部門別アクセス制御/容量管理の強化（Ph1で付与したメタを活用し UI/運用へ拡張）。  
  - 管理UI拡張: システム管理者向けカスタムUI（ダッシュボード/利用状況/ログ閲覧/お知らせ配信）、部門管理者向けUI（部門ダッシュボード、文書/アクセス権限管理、検索エクスポート、アップロード/インデックス管理）。  
  - 検索UI拡張（Want系の追加開発）: 関連性スコア表示、類似検索提案、検索履歴表示、フィードバックコメント入力/保存を段階的に追加。  
  - セキュリティ強化（WAF、PrivateLink/VPC内化、GuardDuty/SecurityHub/Config統合）。  
  - オートスケール調整: フロント（CF/Lambda@Edge or Fargate）、バック/API、LLM呼び出し同時実行、RAG（KB/Kendra or pgvector）、ベクトルDBのスロット/キャパ。  
  - Fargate/ALB構成が必須ならここで切替。
  - 移行効果: インフラ強化は主にフロント差し替えで済み、RAG/LLMのコア実装への影響を最小化。  

- **フェーズ3（+1–2か月）**  
  - DR演習、性能テスト自動化、AIガバナンス高度化（Ph1で導入したガードレールをバイアス/PII含め精緻化）。  
  - メタデータ高度化（分類・辞書補正自動化）、部門ダッシュボード高度化、**データガバナンス強化（RAG投入文書の承認・棚卸し・ライフサイクル管理）**、部門管理者/一般向け UI の残項目（マイページ/通知/FAQ 等）、追加SaaS連携（SharePoint 等）。  
  - コスト最適化（自動起動/停止、モデル/チャンク最適化）。

## 4. フィットギャップ一覧（実装フェーズつき、工数は概算）
| 項目 | RFP | 現状 | 方針 | Phase | 人日 |
| --- | --- | --- | --- | --- | --- |
| 認証・SSO | Entra SAML | ◯ | IdP統合、ドメイン設定、E2Eテスト | P1 | 8–12 |
| API/ガバナンス | 全社標準API | △ | API必須化、仕様/SDK、ガードレール適用 | P1 | 5–8 |
| 文書管理ガバナンス | 承認/棚卸/LC | △ | 承認WF・棚卸し・ライフサイクル管理を追加 | P3 | 10–15 |
| ネットワーク/セキュリティ | WAF/Shield/監査 | △ | P1最小、P2でWAF/Shield/CloudTrail/Config/Inspector | P2 | 20–25 |
| ネットワーク構成（フロント） | ALB+Fargate | × | P1 CF+S3+APIGW+Lambda、P2 Fargate+ALB | P1/P2 | 20–25 |
| オンプレ接続 | TGW+VPN | × | P1パブリックPoC、P2でTGW+VPN（必要ならPrivateLink） | P2 | 10–15 |
| RAG KB（既定） | PostgreSQL指定 | △ | KB/AOSS既定＋Aurora pgvectorオプション | P1/P2 | 25–30 |
| RAG Kendra | Kendra利用 | △ | 任意で維持/不使用 | P1/Opt | 0–10 |
| OCR/表構造保持 | OCR+表保持 | × | TextractでOCR/表→HTML/MD/CSVに前処理 | P1/P2 | 12–18 |
| PDF大容量/分割 | 50MB超や長文PDF | × | P1分割設定、P2自動分割バッチ/ツール追加 | P1/P2 | 6–8 |
| チャンク戦略変更 | セマンティック/階層 | △ | P2でKBのチャンク設定を階層/固定長/セマンティックに調整 | P2 | 4–6 |
| データクレンジング/正規化 | ヘッダ削除・正規化 | × | P2前処理でヘッダ/フッタ除去、全角半角/日付揃え | P2 | 8–12 |
| 辞書補正/ゆらぎ補正 | ISUZU→いすゞ等 | × | P2前処理で辞書補正・ゆらぎ吸収 | P2 | 6–8 |
| Q&A変換・要約タグ付与 | FAQ化/タグ付与 | × | P3 LLMバッチでQA化・タグ/要約生成 | P3 | 12–18 |
| 管理ダッシュボード/利用状況/ログ | 利用/エラー/エクスポート | × | P1 AWSコンソール(CW/Logs/Athena/CT)、P2 カスタムUI | P1/P2 | 12–18 |
| ユーザ管理（全体） | 一覧/ロール/停止 | △ | P1 Cognito/Entraコンソール、P2 必要に応じUI化 | P1/P2 | 5–8 |
| ベクトルDB管理 | 容量/最適化/バックアップ | × | P1 Aurora/KB/AOSSコンソール＋SQL、P2 自動化UI/Runbook | P1/P2 | 10–15 |
| 参照元表示/リンク | 出典/直リンク/ページ | △ | P1 UIに出典・ページ番号・直リンクを表示 | P1 | 6–10 |
| 検索結果プレビュー | チャンク確認 | △ | P1 抜粋/プレビューを明示表示 | P1 | 4–6 |
| 関連性スコア表示 | スコア表示 | × | P2 UIにスコア数値を表示 | P2 | 4–6 |
| フィルター機能 | 日付/メタ絞り込み | △ | P1 既存メタ活用、追加メタ（日付/タグ等）はP2拡張 | P1/P2 | 6–10 |
| 類似検索提案 | 履歴ベクトル検索 | × | P2 履歴から類似クエリを提示（DDB/Logs集計） | P2 | 8–12 |
| 検索履歴表示 | 履歴一覧/再検索 | × | P2 履歴一覧と再実行 | P2 | 6–10 |
| 回答評価 | いいね等 | × | P1 いいね/バッド保存を追加 | P1 | 6–10 |
| フィードバックコメント | 精度/性能FB | × | P3 コメント入力＋保存/外部リンク | P3 | 6–10 |
| 部門ユーザ管理 | 部門ユーザ/権限/容量 | × | P1 部門管理者向け最小UI（APIGW+Lambda+DDB） | P1 | 12–18 |
| 部門管理 | 部門作成/編集/容量 | × | P2 部門管理UI（DDB/Parameter Store） | P2 | 10–15 |
| お知らせ管理 | 障害/告知配信 | × | P2 通知UI＋SNS/メール/バナー配信 | P2 | 8–12 |
| 部門ダッシュボード | 部門内利用/人気KW | × | P2 部門ダッシュボード（CW Logs/Athena集計） | P2 | 12–18 |
| 文書/アクセス権限UI | 文書一覧/メタ/ACL | × | P2 カスタムUI＋API（メタ/ACLをDDB等で管理） | P2 | 18–24 |
| 高度検索/結果エクスポート | フィルタ/エクスポート | △ | P2 UIでフィルタ拡張・結果エクスポート | P2 | 12–18 |
| アップロード/インデックスUI | 一括アップ/進捗/再実行 | × | P2 アップロード＋インデックス状態/再実行UI | P2 | 12–18 |
| マイページ/通知/FAQ | プロフィール/通知/ヘルプ | × | P3 カスタムUI＋通知連携 | P3 | 10–15 |
| Boxパイプライン | Box取込/メタ/通知 | × | P1 最小取込、P2 差分/Webhookと前処理拡張 | P1/P2 | 30–40 |
| SharePointパイプライン | SharePoint取込 | × | P2 Graph APIで定期/差分→S3、必要に応じ前処理 | P2 | 18–24 |
| Box→pgvector | Box→S3→pgvector | × | API連携実装（前処理後にpgvector格納） | P1 | 12–18 |
| 前処理カスタム | Python差込 | △ | 前処理モジュール化し差替え可能に | P1 | 10–15 |
| リランク（pgvector） | リランク必須 | △ | 再ランキングAPI/内製を追加 | P1/P2 | 10–15 |
| メタ情報・部門別制御 | 部門別アクセス制御 | △ | メタ格納＋APIでフィルタ（department/access_level等） | P1 | 12–18 |
| 共通API改修 | メタフィルタ | △ | APIでメタフィルタ適用・検証 | P1 | 8–12 |
| 管理UI | 容量/部門/お知らせ/ログ | △ | 管理UI拡張（容量/部門/告知/ログ閲覧） | P2 | 18–24 |
| AgentCore | エージェント基盤 | ◯ | P1で組込み、以降の開発を集約 | P1 | 5–8 |
| メタ付与/Q&A | 要約/タグ/Q&A | △ | 前処理に生成系ジョブ追加 | P2 | 12–18 |
| オートスケール | 要素別スケール | △ | 各コンポーネントの同時実行/スロット調整 | P2 | 10–15 |
| 性能 | 応答10–60秒 | ◯ | モデル選定/チャンク抑制/同時実行/キャッシュ | P1 | 5–8 |
| 可用性 | RPO24h/RTO12h | △ | DDB PITR、Auroraバックアップ/MAZ、Runbook | P1/P2 | 8–12 |
| 監視 | トークン/ファイル/異常検知 | △ | Dashboards/Athena/アラート調整 | P1 | 6–8 |
| オートスケール/性能・可用性 | サーバレス→Fargate候補 | △ | P1サーバレス、必要ならP2 Fargate常時起動 | P1/P2 | 10–15 |

## 5. 工数目安（概算・人日、実装中心／ざっくりご参考の工数です。AWSアーキテクトに見ていただいた方がいいかも）
- フェーズ1: **60–80人日**  
  - SAML統合 8–12、API標準化 5–8、RAG配線 KB or pgvector 25–30、Box最小取込 20–25、前処理差込 10–15、AgentCore組込み 5–8、性能/可用性初期設定 8–10、監視/Runbook 6–8
- フェーズ2: **55–75人日**  
  - Box Webhook/差分 12–18、メタ付与/Q&A 12–18、管理UI拡張 18–24、Security/WAF/PrivateLink/Hub/Duty 20–25、オートスケール/性能調整 10–15、Fargate/ALB切替（必要時）20–25（重複工数は調整可能）
- フェーズ3: **40–55人日**  
  - DR/性能テスト自動化 10–14、AIガバナンス強化 8–12、ダッシュボード高度化 10–12、追加SaaS連携 10–15、コスト最適化 6–8

※要件定義・テスト・PMは別途。スコープに応じ前後します。

## 6. メモ・補足
- RFP図のフロントは ALB+Fargate。フェーズ1は GenU 標準（CF+S3+APIGW+Lambda）で立ち上げ、フェーズ2でフロントのみ Fargate+ALB に差し替え、API は APIGW+Lambda を継続。  
- RFP図は Site-to-Site VPN + Transit Gateway 前提。フェーズ2で閉域接続を追加（フェーズ1はパブリックで PoC）。  
- Kendra: RFPに明示なし。不要なら外し、KB/pgvectorに一本化。  
- Box: Kendra向けアダプタはあるが、pgvectorルートは自前API実装が必要。  
- Textract: Azure Document Intelligence 相当。スキャンPDF/OCR/表抽出が必要な場合は前処理で利用し、HTML/Markdown/CSVに整形して KB/Kendra へ投入。  
- オートスケール/可用性:  
  - フロント/静的: CF+S3（サーバレス）。Fargate採用時はタスク/ターゲット数でスケール。  
  - API/Lambda: Concurrency・Retry・タイムアウト調整。APIGWスロット設定。  
  - LLM: モデル同時実行上限・軽量モデル優先・チャンク数制御。  
  - RAG KB: KB/AOSS スロット、Aurora pgvector は ACU/最大接続/マルチAZ。  
  - 可用性: サーバレスはマネージド冗長。AuroraはマルチAZ、バックアップ方針明示。DRはコールド/ウォーム選択（RTO/RPOとコストで決定）。
